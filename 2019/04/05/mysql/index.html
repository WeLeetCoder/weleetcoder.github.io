<!-- build time:Thu May 16 2019 00:51:47 GMT+0800 (China Standard Time) --><!DOCTYPE HTML><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="keywords" content="MySQL 学习【转载】, HTML,CSS,Vue,JavaScript,Go,Python,IT"><meta name="description" content="MySQLMySQL 的基本操作可以包括两个方面: MySQL 常用语句如高频率使用的增删改查(CRUD)语句和 MySQL 高级功能, 如存储过程, 触发器, 事务处理器等. 而这两个方面又可以细分如下:Mysql 常用语句表（或者数据库"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>MySQL 学习【转载】 | Azure sky</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0-rc.2/css/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/aos/2.3.4/aos.css"><link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/lightgallery/1.6.11/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="/css/matery.css"><link rel="stylesheet" type="text/css" href="/css/my.css"><style type="text/css"></style><script src="https://www.aliyun.com/zixun/assets/js/jquery-3.2.1.min.js"></script><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Azure sky</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a><ul class="right"><li class="hide-on-med-and-down"><a href="/" class="waves-effect waves-light"><i class="fa fa-home"></i> <span>首页</span></a></li><li class="hide-on-med-and-down"><a href="/tags" class="waves-effect waves-light"><i class="fa fa-tags"></i> <span>标签</span></a></li><li class="hide-on-med-and-down"><a href="/categories" class="waves-effect waves-light"><i class="fa fa-bookmark"></i> <span>分类</span></a></li><li class="hide-on-med-and-down"><a href="/archives" class="waves-effect waves-light"><i class="fa fa-archive"></i> <span>归档</span></a></li><li class="hide-on-med-and-down"><a href="/about" class="waves-effect waves-light"><i class="fa fa-user-circle-o"></i> <span>关于</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fa fa-search" title="搜索"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Azure sky</div><div class="logo-desc">人要学会走路，也要学会摔跤，而且只有学会摔跤，他才能学会走路。—— [德]马克思</div></div><ul class="menu-list mobile-menu-list"><li><a href="/" class="waves-effect waves-light"><i class="fa fa-fw fa-home"></i> 首页</a></li><li><a href="/tags" class="waves-effect waves-light"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li><a href="/categories" class="waves-effect waves-light"><i class="fa fa-fw fa-bookmark"></i> 分类</a></li><li><a href="/archives" class="waves-effect waves-light"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li><a href="/about" class="waves-effect waves-light"><i class="fa fa-fw fa-user-circle-o"></i> 关于</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/8.jpg)"><div class="container"><div class="row"><div class="col s12 m12 l12"><div class="brand"><div class="description center-align post-title">MySQL 学习【转载】</div></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px}#toc-content .is-active-link{color:#42b983}#toc-content .is-active-link::before{background-color:#42b983}#floating-toc-btn{position:fixed;right:20px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/mysql/" target="_blank"><span class="chip bg-color">mysql</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fa fa-bookmark fa-fw icon-category"></i> <a href="/categories/技术学习/" class="post-category" target="_blank">技术学习</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp; 2019-04-05</div><div class="info-break-policy"><i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp; 24 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp; <span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><blockquote><p>MySQL 的基本操作可以包括两个方面: MySQL 常用语句如高频率使用的增删改查(CRUD)语句和 MySQL 高级功能, 如存储过程, 触发器, 事务处理器等. 而这两个方面又可以细分如下:</p></blockquote><p><img src="https://ws1.sinaimg.cn/large/007Ie89nly1g1t17iconcj30td0qojru.jpg" alt="mysql"></p><h4 id="Mysql-常用语句"><a href="#Mysql-常用语句" class="headerlink" title="Mysql 常用语句"></a>Mysql 常用语句</h4><ol><li>表（或者数据库）的 CRUD。</li><li>表数据的 <code>CRUD</code>，其中表数据查询使用最多，也更复杂。查询可以按照单表还是多表可以分为： 单表<code>SELECT</code>查询和夺标的连接查询（<code>INNER JOIN</code>，<code>LEFT JOIN</code>，<code>RIGHT JOIN</code>和<code>FULL JOIN</code>）以及组合查询<code>UNION</code>以及组合查询<code>UNION</code>和<code>UNION ALL</code>。</li><li>SQL 语句中各个关键字的执行顺序。</li></ol><h2 id="1-表（或数据库）操作语句"><a href="#1-表（或数据库）操作语句" class="headerlink" title="1. 表（或数据库）操作语句"></a>1. 表（或数据库）操作语句</h2><h4 id="1-1-查询表（或数据库）"><a href="#1-1-查询表（或数据库）" class="headerlink" title="1.1 查询表（或数据库）"></a>1.1 查询表（或数据库）</h4><ol><li><strong>获取所有可用的数据库：</strong> <code>SHOW DATABASES</code>。</li><li><strong>选择数据库：</strong><code>USE &lt;databaseName&gt;</code>。</li><li><em>用于显示数据库服务器状态信息：</em><code>SHOW STATUS</code>。</li><li><em>用来显示授权用户的安全权限：</em> <code>SHOW GRANTS</code>。</li><li><em>用来显示数据服务器或警告信息：</em> <code>SHOW ERRORS</code> 或者<code>SHOW WARNINGS</code>。</li><li><strong>用于显示创建数据库是的创建语句：</strong> <code>SHOW CREATE DATABASE &lt;databaseName&gt;</code>。</li><li><strong>用于显示创建表示的创建语句：</strong> <code>SHOW CREATE DATABASE &lt;tableName&gt;</code>。</li><li><strong>获取当前所选的数据库中所有可用的表：</strong> <code>SHOW TABLES</code> 。</li><li><strong>获取表中所有列的信息：</strong> <code>SHOW COLUMNS FROM &lt;tableName&gt;</code>；<code>DESCRIBE</code> 语句也具有相同的效果： <code>DESCRIBE &lt;tableName&gt;</code>。</li></ol><h3 id="1-2-新建表或数据库"><a href="#1-2-新建表或数据库" class="headerlink" title="1.2 新建表或数据库"></a>1.2 新建表或数据库</h3><ol><li><em>新建数据库：</em> <code>CREATE DATABASE &lt;databaseName&gt;</code>。</li><li><strong>创建表可以使用 <code>CREATE TABLE</code> 语句:</strong></li></ol><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customers <span class="token punctuation">(</span>
    cust_id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    cust_name CHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_age <span class="token keyword">INT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span><span class="token punctuation">;</span>
</code></pre><h6 id="解释："><a href="#解释：" class="headerlink" title="解释："></a>解释：</h6><ol><li>允许 <strong>NULL</strong> 值， 则说明再插入行数据时允许不给出该列的值，而 <strong>NOT NULL</strong> 则表示在插入或更新该列数据，必须明确给出该列的值。</li><li><strong>DEFAULT</strong>表示该列的默认值，在插入行数据时，若没有给出该列的值就会使用其指定的默认值；</li><li><strong>PRIMARY KEY</strong> 用于指定主键，主键可以指定一列数据，而可以由多列数据组合构成，如 <code>PRIMARY KEY(cust_id, cust_name)</code>;</li><li><strong>ENGINE</strong> 用于指定引擎类型。<br>常见的引擎类型又这些：<br>（1）InnoDB 是一个支持可靠的事务处理的引擎，但是不支持全文本搜索；<br>（2）MyISAM 是一个新能极高的引擎，它支持全文本搜索，但不支持事务处理；<br>（3）MEMORY 在功能上等同与 MyISAM，由于数据存储在内存中，速度很快（特别适何临时表）；</li></ol><p>3.在创建表的时候可以使用 <strong>FOREING KEY</strong> 来创建外键，即一个表中的<code>FOREING KEY</code><br>指向另一个表中的 <strong>PRIMARY KEY</strong>。外键 <strong>FOREING kEY</strong>用于约束破坏表的联结（连接）动作，保证连个表的数据完整性。同时也能防止非法数据插入外键列，因为该列值必须指向另一个表的主键。实例如下：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders <span class="token punctuation">(</span>
    Id_O <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    OrderNo <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    Id_P <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Id_O<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>Id_P<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Persons<span class="token punctuation">(</span>Id_P<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><h3 id="1-3-删除表或数据库"><a href="#1-3-删除表或数据库" class="headerlink" title="1.3 删除表或数据库"></a>1.3 删除表或数据库</h3><ol><li><strong>删除数据库：</strong> <code>DROP DATABASE &lt;databaseName&gt;</code>。</li><li><strong>删除表：</strong> <code>DROP TABLE &lt;tableName&gt;</code>。</li></ol><h3 id="1-4-更新表"><a href="#1-4-更新表" class="headerlink" title="1.4 更新表"></a>1.4 更新表</h3><ol><li>更新表结构信息可以使用 <strong>ALTER TABLE</strong> 字句，如为表怎加一列：<br><code>ALTER TABLE vendors ADD vend_name CHAR(20)</code>。另外进场用于定义外键，如：</li></ol><pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> customers
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_custormer_orders  
<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> orders <span class="token punctuation">(</span>order_cust<span class="token punctuation">)</span>
</code></pre><ol start="2"><li>重命名表， 使用 <code>RENAME</code> 子句。 <code>RENAME TABLE backup_customers TO customers, backup_vendors TO vendors</code>；更改多个表名，之间用逗号间隔。</li></ol><h2 id="2-表数据操作语句"><a href="#2-表数据操作语句" class="headerlink" title="2 表数据操作语句"></a>2 表数据操作语句</h2><h3 id="2-1-查询表数据"><a href="#2-1-查询表数据" class="headerlink" title="2.1 查询表数据"></a>2.1 查询表数据</h3><blockquote><p>基本操作语句</p></blockquote><ol><li><p>根据过滤条件春训表中的单列或者多列或者全部列的信息 <strong>SELECT FROM WHERE：</strong> <code>SELECT cust_id, cust_name, FROM customers WHERE cust_id=10000</code>;<br>其中，过滤条件操作符有： <code>=, &lt;&gt;, !=, &lt;, &lt;=, &gt;, &gt;=</code> 和 <code>BETWEEN AND, IS NULL</code>;</p></li><li><p>为查询出的某一列信息去重 <strong>DISTINCT：</strong><br><code>SELECT DISTINCT cust_name FROM customers</code>;</p></li><li><p>限制单列查询结果的行数： <code>SELECT cust_name FROM customers LIMIT 5</code>; <em>LIMIT</em>后跟一个数值，表示从第 0 行开始取，共取 5 行数据；如果 <strong>LIMIT 5,5</strong> 表示从第 6 行（数据库中行数是从 0 开始的，所以是第 6 行）开始取，共取 5 行数据。</p></li></ol><p>4.　<strong>ORDER BY</strong> 子句取一个或者多个列，据此对输出进行排序：<br><code>SELECT cust_id, cust_name FROM customers ORDER BY cust_id DESC, cust_name</code>；</p><ol start="5"><li><p><strong>IN</strong> 操作符用来指定条件范围，范围中的每个条件都可以进行匹配：<br><code>SELECT cust_id, cust_name FROM customers WHERE cust_id IN (10000, 20000)</code>；</p></li><li><p><strong>LIKE</strong> 操作符用来表明模糊查询，与之配合使用的通配符有 <strong><code>% _</code></strong>，<code>%</code> 表示任何字符出现任何次数； <strong>_</strong> 表示匹配一个字符：<br><code>SELECT cust_id, cust_name FROM customers WhERE cust_name LIKE &#39;%happy%&#39;</code>;</p></li><li><p>使用分组查询并可以满足一定的分组过滤条件 <strong>GROUP BY HAVING</strong>。如检索总计订单金额大于 50 的订单号和订单总金额，并按总金额进行排序：<br><code>SELECT order_num, SUM(quantity * item_price) AS order_total FROM orderitems GROUP BY order_num HAVING SUM(quantity * item_price) &gt;= 50 ORDER BY order_total</code>;</p></li><li><p><strong>WHERE</strong> 和 <strong>HAVING</strong> 的比较。<em>WHERE</em> 是行级过滤，而 <em>HAVING</em> 组级过滤。被 <em>WHERE</em> 过滤掉的数据不会出现在分组中。 <em>WHERE</em> 中通配符以及多个 <em>WHERE</em> 子句的连接同样适用于 <em>HAVING</em> 子句；</p></li><li><p><strong>GROUP BY</strong> 的使用注意事项：<br>（1）<code>GROUP BY</code> 子句中可以嵌套分组（即通过多个列进行分组 <code>GROUP BY cust_id, cust_name</code>），但是尽心数据汇总时，是在最后规定的分组上进行；<br>（2）<code>GROUP BY</code> 子句中列出的每个列都必须时检索列或者时有效的表达式。<br>（3）如果有 <em>NULL</em> 值，将 <em>NULL</em> 值作为一个分组尽心返回，若果有多行 <em>NULL</em> 值，他们将分为一组。</p></li><li><p>嵌套其他查询中的查询，被称之为 <strong>子查询</strong>。执行过程由里向外，里层查询结作为外层查询的条件：<br><code>SELECT cust_id FROM orders WHERE order_num IN (SELECT order_num FROM orderitems WHERE prod_id = &#39;happy&#39;)</code>；当然，多表的查询可以是用联结（连接）查询。</p></li></ol><blockquote><p>联结（连接）查询</p></blockquote><ol><li>内联结又称之为内部联结，是基于两个表之间的相等测试。如果不加过滤条件，会造成 <a href="https://zh.wikipedia.org/wiki/%E7%AC%9B%E5%8D%A1%E5%84%BF%E7%A7%AF" target="_blank" rel="noopener"><em>笛卡尔积</em></a>。<br><code>SELECT vend_name, prod_name, prod_price FROM vendors INNER JOIN products ON vendors.vend_id = products.vend_id</code>;同样可以使用 <code>WHERE</code> 子句进行多表联结查询，但是更推荐使用 <code>INNER JOIN</code> 等联结方式；</li><li>外部链接包括左外联结 <strong><code>LEFT JOIN</code></strong> 和右外联结 <strong><code>RIGHT JOIN</code></strong>。例如查询每个客户的订单数：<code>SELECT customers.cust_id, orders.orders_num FROM customers LEFT JOIN orders ON orders.cust_id = customers.cust_id</code>；<em>LEFT JOIN</em> 会全部返回坐标数据，<em>RIGHT JOIN</em> 会全部返回右表数据，<em>FULL JOIN</em>会将左右两个表的数据全部返回；</li><li>联合查询与聚集函数一起使用。如查询每个客户的订单数：<br><code>SELECT customers.cust_name, customers.cust_id, COUNT(order.order_num) AS num_ord FROM customers INNER JOIN orders ON customers.cust_id = orders.cust_id GROUP BY customers.cust_id</code>;</li></ol><blockquote><p>组合查询</p></blockquote><ol><li><p>多个查询（<strong>SELECT</strong>）可以使用 <strong>UNION</strong> 将多个查询结果尽心合并成一个结果集返回，<strong>UNION</strong> 必须宝行两个及两个以上的 <strong>SELECT</strong> 查询，斌且每个毕珣宝行相同的列、表达式或聚集函数，数据类型不必完全相同，<strong>MySQL</strong> 会进行隐式的类型转换。</p></li><li><p><strong>UNION</strong> 返回的是去重后的结果，如果不需要去重则可以使用 <strong>UNION ALL</strong>；</p></li><li><p>可以多组合查询使用 <strong>ORDER BY</strong> 进行排序,但是是针对最终的结果集进行排序,而不是其中单个 <strong>SELECT</strong> 查询进行排序, 因此对于组合查询来说 <strong>ORDER BY</strong> 子句只有一个。<br><code>SELECT vend_id， prod_id, prod_price FROM products WHERE prod_price &gt; 5 UNION SELECT vend_id, prod_id, prod_price FROM products WHERE vend_id IN(1001, 1002) ORDER BY vend_id</code>；</p></li></ol><blockquote><p>使用函数对数据进行处理</p></blockquote><ol><li><p>拼接列名：<br><code>SELECT Concat (vendName, &#39;(&#39;vendCountry,&#39;)&#39;) From vendors ORDER BY vendName</code>;</p></li><li><p>执行算数表达式计算：<br><code>SELECT prodId, quantity, price, quantity * price AS expandedPrice FROM ORDERiTEMS</code>;</p></li><li><p>文本处理函数如 Upper(), LTrim()等函数。 比如使用 Upper 函数将文本转换成大写：<br><code>SELECT vendName, Upper(vendName) FROM vendors ORDER BY vendName</code></p></li><li><p>时间和日期处理函数，如 Date(), Day()等。<br><code>SELECT COUNT(*) AS numbers, MIN(prod_price) AS price_min,MAX(PROD_PRICE) AS price_max, AVG(prod_price) AS price_avg FROM products</code>;</p></li><li><p>数值处理函数，如 ABS(),COS()等；</p></li><li><p>常用的聚集函数。如 AVG(),COUNT(),MAX(),MIN()以及 SUM()。<br><code>SELECT COUNT(*) AS numbers, MIN(prod_price) AS price_min, MAX(prod_price) AS price_max, AVG(prod_price) AS price_avg FROM products</code>;</p></li></ol><h3 id="插入表数据"><a href="#插入表数据" class="headerlink" title="插入表数据"></a>插入表数据</h3><ol><li>向表中插入行数据可以使用 <strong>INSERT INTO</strong> 子句，更安全的方式是指定列名。 <code>INSERT INTO customers (cust_name, cust_email) VALUES (&#39;happy&#39;, &#39;happy@gmail.com&#39;);</code> 在 <strong>INSERT INTO</strong> 子句中能够省略列名的前提条件是：该列可以允许定义为 NULL 值或者在定义时给出去了默认值；</li><li>如果插入多行数据可以将多组值用逗号进行分隔即可。<br><code>INSERT INTO customers (cust_name, cust_email) VALUES (&#39;happy&#39;, &#39;happy@gmail.com&#39;),(&#39;smart&#39;, &#39;smart@gmail.com&#39;);</code></li><li>将查询出来的数据插入表中，可以使用 <strong>INSERT SELECT</strong> 语句。<br><code>INSERT INTO customers(cust_id, cust_contact) SELECT cust_id, cust_conntact FROM customer WHERE cust_id &gt; 5;</code> 其中 SELECT 中可以带 WHERE 过滤条件；<strong>INSERT SELECT</strong>通常被用于复制表数据。</li></ol><h3 id="更新表数据"><a href="#更新表数据" class="headerlink" title="更新表数据"></a>更新表数据</h3><ol><li>如果要更新表数据的话，使用 <strong>UPDATE</strong> 子句：<br><code>UPDATE customers SET cust_name = &#39;happy&#39;, cust_email = &#39;happy@gmail.com&#39; WHERE cust_id = 1001;</code></li><li>注意： 如果不加 <strong>WHERE</strong> 条件指定到某一行的话，会更新表中某一列的全部的数据。</li></ol><h3 id="删除表数据"><a href="#删除表数据" class="headerlink" title="删除表数据"></a>删除表数据</h3><ol><li>如果从表中删除数据的话，可以使用 <strong>DELETE</strong> 子句。<br><code>DELETE FROM customers WHERE cust_id = 10086;</code><br>删除的数据必定是表中行数据，而不是某一列。因此，与 <strong>UPDATE</strong> 子句相比，<strong>DELETE</strong> 子句并不需要指定是哪一列，而仅仅只需要指定具体的表明即可；</li><li><strong>注意： 如果不添加 WHERE 指定条件的话，会将整个表中的所有行数据全部删除。另外，DELETE 只是删除表中的数据，而不会删除表结构信息；</strong></li><li>如果想删除表中的全部的数据，可以使用 <strong>TRUNCATE</strong>，比 <strong>DELETE</strong> 删除效率更高；</li></ol><h2 id="SQL-中关键字执行顺序"><a href="#SQL-中关键字执行顺序" class="headerlink" title="SQL 中关键字执行顺序"></a>SQL 中关键字执行顺序</h2><p>在 SQL 语句中每个关键字都会按照顺序往下执行，而每一步操作，都会生成一个虚拟表，最后产生的虚拟表会作为执行的最终结果返回。下面的是常用的关键字的执行顺序：</p><pre><code>(1)FROM &lt;left_table&gt;
(2)ON &lt;join_condition&gt;
(3)&lt;join_type&gt; JOIN &lt;right_table&gt;
(4)WHERE &lt;where_condition&gt;
(5)GROUP BY&lt;group_by_list&gt;
(6)WITH{CUBE|ROLLUP}
(7)HAVING&lt;having_condition&gt;
(8)SELECT
(9)DISTINCT&lt;select_list&gt;
(10)ORDER BY&lt;order_by_list&gt;
(11)LIMIT&lt;limit_number&gt;
</code></pre><ol><li><strong>FROM</strong>：对 FROM 左边的表和邮编的表计算笛卡尔积，产生虚拟表 VT1；</li><li><strong>ON</strong>：对虚拟表 VT1 进行 ON 筛选，只有那些符合&lt;join_condition&gt; 条件的行才会被记录在虚拟表 VT2 中；</li><li><strong>JOIN</strong>：如果是 OUT JOIN，name 将保留表中（如左表或者右表）未匹配的行作为外部行添加到虚拟表 VT2 中，从而产生虚拟表 VT3；</li><li><strong>WHERE</strong>：对虚拟表 VT3 进行 WHERE 条件过滤，只有符合&lt;where_condition&gt;的记录才会别放入到虚拟表 VT4；</li><li><strong>GROUP BY</strong>：根据 GROUP BY 子句中的列，对虚拟表 VT4 进行分组操作，产生虚拟表 VT5；</li><li><strong>CUBE | ROLLUP</strong>：对虚拟表 VT5 进行 CUBE 或者 ROLLUP 操作，产生虚拟表 VT6；</li><li><strong>HAVING</strong>：对虚拟表 VT6 进行 HAVING 条件过滤，只有符合&lt;having_condition&gt;的记录才会别插入到虚拟表 VT7 中；</li><li><strong>SELECT</strong>：执行 SELECT 操作，选择指定的列，插入到虚拟表 VT8 中；</li><li><strong>DISTINCT</strong>：对虚拟表 VT8 中的记录进行去重，产生虚拟表 VT9；</li><li><strong>ORDER BY</strong>：将虚拟表 VT9 中的记录按照&lt;order_by_list&gt;进行排序操作，产生虚拟表 VT10；</li><li><strong>LIMIT</strong>：取出指定行的记录，产生虚拟表 VT11，并将结果返回。</li></ol><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote><p>MySQL 缩影的简历对于 MySQL 的高效运行是很重要的，索引可以大大提高 MySQL 的检索速度。索引分单列索引和组合索引。单列索引，即一个索引只包含单个列，而组合索引，即一个索引包含多个列。</p></blockquote><h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>创建索引有两种方式，一种是直接利用 <strong>CREATE INDEX</strong>进行创建，另外一种则是通过修改表结构来进行添加，则是利用 <strong>ALTER TABLE</strong>语句。</p><ol><li><p>使用<code>CREATE INDEX</code></p><p>语法为：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL<span class="token punctuation">]</span>
<span class="token keyword">INDEX</span> index_name
<span class="token punctuation">[</span><span class="token keyword">USING</span> index_type<span class="token punctuation">]</span>
<span class="token keyword">ON</span> table_name <span class="token punctuation">(</span>index_col_name<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre><p>其中对应的语法变量信息如下：</p><blockquote><p>[UNIQUE | FULLTEXT | SPATIAL]</p></blockquote><p>其中括号中的这三个关键字表示创建索引类型，他们分别表示 <strong>唯一索引，全文索引，空间索引</strong> 三种不同的索引类型。如果我们不指定任何关键字，则默认为普通索引。</p><blockquote><p>index_name</p></blockquote><p><code>index_name</code> 表示索引的名称，又用户自行定义，仪表与以后对该索引进行管理操作。</p><blockquote><p>index_type</p></blockquote><p><code>index_type</code> 表示索引的具体实现凡是，在 MySQL 中，有两种不同形式的索引 —— <strong>BTREE</strong> 索引和 <strong>HASH</strong> 索引。在存储引擎为 <strong>MyISAM</strong> 和 <strong>InnoDB</strong> 的表中只能使用 BTREE，其默认值就是 BTREE；在存储引擎为 MEMORY 或者 HEAP 的表中可以使用 HASH 和 BTREE 两种类型的索引，其默认值为 HASH。</p><blockquote><p>index_col_name</p></blockquote><p><code>index_col_name</code> 表示需要创建索引的字段名称，我们还可以针对多个字段创建复合索引，只需要多个字段名称之间以英文逗号隔开即可。此外，对于 CHAR 或者 VARCHAR 类型的字段，我们还可以值使用字段内容前面的一部分来闯进啊索引，只需要在对应的字段名称后米昂加上形如（<em>length</em>）的指令即可，表示只需要使用字段内容前面的 <em>length</em> 个字符来创建索引。在这里我们以 customers 表的 cust_name 字段（类型为 VARCHAR（50））为例，使用 cust_name 字段的 6 个字符前缀来创建索引。</p><pre><code>CREATE INDEX idx_cust_name ON user (cust_name(6));
</code></pre></li><li><p>使用 ALTER TABLE</p><p>语法为：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name
ADO <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span><span class="token operator">|</span>FULLTEXT<span class="token operator">|</span>SPATIAL<span class="token punctuation">]</span>
<span class="token keyword">INDEX</span> index_name <span class="token punctuation">(</span>index_col_name<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token keyword">USING</span> index_type<span class="token punctuation">]</span>
</code></pre></li></ol><h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>删除指定表中的特定名称的索引，语法为：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> table_name
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> index_name<span class="token punctuation">;</span>
</code></pre><p>例如删除名称为 idx_cust_name 的索引，其 SQL 语句为：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> customers
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_cust_name<span class="token punctuation">;</span>
</code></pre><h3 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h3><p>在 MySQL 中并没有提供修改索引的直接指令，一般情况下，我们需要先删除掉元索引，再根据需要创建一个同名的索引，从而变相的实现修改索引的操作。</p><pre class="language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 先删除索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token keyword">user</span>
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> idx_user_username<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--  再以修改后的内容创建同名索引</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_cust_name <span class="token keyword">ON</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h3><p>再 MySQL 中，要查看某个数据库表中的索引也非常简单，只需要使用一下两个命令中的任意一种即可。</p><pre class="language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- 如果查看索引前，没有使用 use db_name 等命令指定具体的数据库，则必须加上 FROM db_name</span>
<span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> table_name <span class="token punctuation">[</span><span class="token keyword">FROM</span> db_name<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">-- 如果查看索引前，没有使用 use db_name 等命令指定具体的数据库，则必须加上 db_name. 前缀</span>
<span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span>db_name<span class="token punctuation">.</span><span class="token punctuation">]</span>table_name
</code></pre><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><ol><li><p>什么是存储过程？存储过程简单的来说，就是为了复用性或者实现复杂的业务功能，而保存的一条或者多条 MySQL 语句的集合，可将其视为批文件；</p></li><li><p>为什么使用存储过程？<br>（1）通过把处理封装在容易使用的单元中，简化复杂的操作；<br>（2）由于不要求反复建立一系列的处理步骤，这保证了数据的完整性，如果所有的开发人员和应用程序都使用同一存储过程，则所使用的代码都是相同的；<br>（3）简化对变动的管理。如果表名、列名或业务逻辑有变化，只需要更改存储过程的代码，使用它的开发人员升值不需要知道这些变化，也就是具备了安全性；<br>（4）提高了性能，因为使用存储过程单独使用 SQL 语句要快；<br>（5）存储过程可用来编写功能更灵活的代码。因此，存储过程的具备三个特性： <strong>简单可复用、安全、高性能</strong>；</p></li><li>存储过程的缺点？<br>（1）存储过程编比基本的 SQL 语句更加复杂，需要更高的技能；<br>（2）可能没有创建存储过程的权限，数据库管理员可能会限制存储过程的权限，允许用户使用存储过程，而不允许用户自由创建存储过程；</li></ol><blockquote><h4 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h4></blockquote><ol><li>创建存储过程。如需要统计用户订单总金额，如果该用户需要交税的话，订单总金额则需要再加上税费：</li></ol><pre class="language-sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment" spellcheck="true">//</span>
 <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span>
 <span class="token operator">IN</span> custid <span class="token keyword">INT</span><span class="token punctuation">,</span>
 <span class="token operator">IN</span> taxable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>
 <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token punctuation">)</span><span class="token keyword">COMMENT</span> <span class="token string">'obtain total order price'</span>

 <span class="token keyword">BEGIN</span>

 <span class="token comment" spellcheck="true">/*declare variable for total*/</span>
 <span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>


 <span class="token comment" spellcheck="true">/*get the order total*/</span>

 <span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>item_quantity<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total
 <span class="token keyword">FROM</span> customers
 <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> custid<span class="token punctuation">;</span>

 <span class="token comment" spellcheck="true">/*is this taxable?*/</span>

 <span class="token keyword">IF</span> taxable <span class="token keyword">THEN</span>
     <span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
 <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
 <span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>
 <span class="token keyword">END</span> <span class="token comment" spellcheck="true">//</span>
</code></pre><p>有这样的一些细节：</p><ol><li>使用 <code>CREATE PROCEDURE</code> 语句进行创建，()圆括号中为存储过程的参数，其中参数类型有：<ol><li><strong>IN</strong> 类型，表示传递给存储过程；</li><li><strong>OUT</strong> 类型，表示存储过程返回的结果，在调用存储过程是需要传入@开始的变量；</li><li><strong>INOUT</strong> 类型，表示在存储过程中可以传入和传出；</li></ol></li><li><em>DECLARE</em> 用力啊生命一个变量，如这里的 total，taxrate。注意 MySQL 中定义变量时都是变量名在前，数据类型在后。</li><li>存储过程具体逻辑写在 <em>BEGIN END</em> 之间；</li><li>将值付给变量使用 <em>INTO</em> 关键字；</li><li>由于存储过程中每个 SQL 语句中用 <code>;</code> 作为分隔符，回合单个 SQL 造成冲突，因此可以使用 <em>DELIMITER</em> 重新定义分类符，如该例子中定义 <code>//</code> 作为分隔符，自然存储过程结尾就用 <code>END //</code> 结尾，而不再是 END。同时，分隔符 <code>//</code> 成对出现后，回复到默认的 <code>;</code> 作为分隔符；</li></ol><blockquote><h4 id="执行存储过程"><a href="#执行存储过程" class="headerlink" title="执行存储过程"></a>执行存储过程</h4></blockquote><ol><li>使用 <em>CALL</em> 子句执行存储过程， <em>CALL</em> 子句接受存储过程的名称以及需要传递的参数。</li></ol><pre class="language-sql"><code class="language-sql"><span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span>
</code></pre><p>如果存储过程中定义了 OUT 类型的输入参数，那么在执行存储过程时需要传入变量，如这里的@total，并且变量都是用@开始的。如果存储过程中么有参数的话，就用空圆括号表示即可：<br><code>CALL ordertotal()</code>；</p><blockquote><h4 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h4></blockquote><p>删除存储过程，可以使用 <em>DROP PROCEDURE</em> 子句。如：<br><code>DROP PROCEDURE ordertotal</code>；</p><blockquote><h4 id="查询存储过程"><a href="#查询存储过程" class="headerlink" title="查询存储过程"></a>查询存储过程</h4></blockquote><ol><li>显示创建一个存储过程的语句，可以使用 <em>SHOW CREATE PROCEDURE</em>。如：<br><code>SHOW CREATE PROCEDURE ordertotal</code>；</li><li>查询所有存储过程的状态，如果在定义存储过程中时用 <em>COMMENT</em> 添加注释，可以查看。同时可以 LIKE 进行过滤结果。如：<br><code>SHOW PROCEDURE STATUS LIKE &#39;%ORDER%&#39;</code>；</li></ol><h2 id="事物处理"><a href="#事物处理" class="headerlink" title="事物处理"></a>事物处理</h2><ol><li><p>什么是事务？<br>事务处理是用来维护数据库的完整性，它保证成批的 MySQL 操作要么完全执行，要么完全不执行。事务处理是一种机制，用来管理必须成批执行的 MySQL 操作，它们要么是作为整体执行或者完全不执行。</p></li><li><p>关键概念：</p><ol><li>事务：是指一组 SQL 语句；</li><li>回退：是指撤销指定的 SQL 语句的过程；</li><li>提交：指将为存储的 SQL 语句的结果写入数据库表中；</li><li>保留点：指事务处理中设置的临时占位符，可以对他发布回退；</li></ol></li><li><p>如何执行事务？</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> item_quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
<span class="token keyword">SAVEPOINT</span> insertinto<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> item_quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> insertinto<span class="token punctuation">;</span>
</code></pre><p>执行结果为：插入数据（’1’, 5, 18)有效，因为，只会从保留点 SAFEPOINT 之后开始回退，也就是说保留点 SAFEPOINT 之前的 SQL 语句执行的结果仍然有效。</p><p>有这样一些细节：</p><ol><li><strong>START TRANSACTION</strong> 用来表示下面的 SQL 语句集为一段事务；</li><li><strong>SAFEPOINT</strong> 用于指定保留点 insertinto；</li><li><strong>ROLLBACK TO</strong> 表示草你个指定保留点开始回退，也就是说保留点之前的 SQL 语句执行结果任然有效。如果仅仅使用 ROLLBACK 进行回退的话就表示从 START TRANSACTION 之后所有的 SQL 语句执行效果都会撤销；</li></ol></li><li><p>MySQL 提交（写或保存）操作室自动进行的，这称之为隐含提交。但是在事务处理块中，提交不会隐含进行，要使用 <em>COMMIT</em> 子句进行提交。如：</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> item_quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> item_quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><p>采用 <em>COMMIT</em> 提交事务，如果两条 SQL 语句都执行成功，才会将数据都写入表中。</p></li></ol><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><ol><li><p>什么是触发器？</p><p>当某条 SQL 语句发生时，自动执行某些其他的 SQL 语句的时候就需要使用触发器。触发器只能响应： <strong>DELETE，INSERT，UPDATE</strong> 这三个特定操作。</p></li><li><p>如何创建触发器？</p><p>创建触发器时需要给出最重要的四条信息：</p><ol><li>全局唯一的触发器名；</li><li>触发器关联的表；</li><li>触发器在合适执行（操作执行之前或者之后）</li><li>触发器应该响应的活动（<em>DELETE，INSERT，UPDATE</em>）；</li></ol><p>由于触发器只能响应特定的三种类型的操作，因此可闯进啊的触发器也就三种类型：<strong>INSERT</strong>触发器，<strong>DELETE</strong>触发器，以及 <strong>UPDATE</strong>触发器。</p><blockquote><h4 id="INSERT-触发器"><a href="#INSERT-触发器" class="headerlink" title="INSERT 触发器"></a>INSERT 触发器</h4></blockquote><p>在执行 INSERT 触发器时，有这样几点需要注意：</p><ol><li>在 INSERT 触发器代码内，可以引用一个名为 NEW 的虚拟表，可以用 NEW 来访问刚插入的行数据；</li><li>在 BEFORE INSERT 触发器中，NEW 中的值可以被更新；</li><li>对于 AUTO_INCREMENT 列，NEW 在 INSERT 执行之前包含 0，在 INSERT 执行之后包含行的自定生成值。</li></ol><p>创建一个 INSERT 触发器，每次插入一行数据，每次会返回单签常茹的行数据的 id：</p><pre class="language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">/*创建触发器*/</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> insertcustomers <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> customers
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>cust_id <span class="token keyword">INTO</span> <span class="token variable">@newinsertid</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/*执行触发器*/</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers （cust_name<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> item_quantity<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@newinsertid</span><span class="token punctuation">;</span>
</code></pre><p>有这样一些细节：</p><ol><li>使用 <em>CREATE TRIGGER</em> 来创建触发器；</li><li><em>AFTER INSERT</em> 表明在插入行数据之后，触发器才会执行特定操作；</li><li><em>FOR EACH ROW</em> 表示对插入的每一行数据，触发器都起作用；</li><li>针对 INSERT 触发器，可以使用虚拟表 NEW，来使用刚插入的行数据。比如例子中：<br>`SELECT NEW.cust_id INTO @newinsertid 表示将新插入的行数据的 id 赋值给变量@newinsertid；</li></ol><blockquote><h4 id="DELETE-触发器"><a href="#DELETE-触发器" class="headerlink" title="DELETE 触发器"></a>DELETE 触发器</h4></blockquote><p><em>DELETE</em> 触发器在 DELETE 语句执行之前或者之后，需要知道以下两点：</p><ol><li>在 DELETE 触发器代码内，可以应用一个名为 OLD 的虚拟表，来访问被删除的行；</li><li>OLD 表中的数据只能读，不能被更新，而在 INSERT 触发器中，就可以通过 NEW 来更新被插入的行数据；</li></ol><p>例如,针对 customers 表，当删除一行数据时，返回被删除的 <code>cust_id</code> 以及 <code>cust_name</code>：</p><pre class="language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">/*创建DELETE触发器*/</span>
<span class="token keyword">DELIMITER</span> <span class="token comment" spellcheck="true">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> insertcustomers <span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> customers
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">SELECT</span> OLD<span class="token punctuation">.</span>cust_name <span class="token keyword">INTO</span> <span class="token variable">@deletecustname</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> OLD<span class="token punctuation">.</span>cust_id <span class="token keyword">INTO</span> <span class="token variable">@deletecustid</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment" spellcheck="true">//</span>

<span class="token comment" spellcheck="true">/*调用DELETE触发器*/</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@deletecustname</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@deletecustid</span><span class="token punctuation">;</span>
</code></pre><p>基本上与创建 INSERT 触发器一样，只不过在 DELETE 触发器中只能使用 OLD 来访问被删除的行数据。</p></li></ol><blockquote><h4 id="UPDATE-触发器"><a href="#UPDATE-触发器" class="headerlink" title="UPDATE 触发器"></a>UPDATE 触发器</h4></blockquote><p>UPDATE 触发器在 UPDATE 语句执行前或者之后执行，需要知道几点：</p><ol><li>在 BEFORE UPDATE 触发器中可以使用 NEW 和 OLD 来访问数据，而在 AFTER UPDATE 触发器中使用 NEW 来访问数据会报错，只能使用 OLD 来访问数据；</li><li>在 BEFORE UPDATE 触发器中，NEW 中的值可以改变，即允许更改将用户 UPDATE 的数据；</li><li>OLD 中的行数据只能读，不能被更新；</li></ol><p>一个 UPDATE 触发器示例如下：</p><pre class="language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">/*创建触发器*/</span>

<span class="token keyword">DELIMITER</span> <span class="token comment" spellcheck="true">//</span>
<span class="token keyword">DELETE</span> <span class="token keyword">TRIGGER</span> insertcustomers BEFORE <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> customers
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>

<span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>cust_name <span class="token keyword">INTO</span> <span class="token variable">@beforeupdate</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>cust_name <span class="token operator">=</span> <span class="token string">'reset_name'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> OLD<span class="token punctuation">.</span>cust_name <span class="token keyword">INTO</span> <span class="token variable">@afterupdate</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment" spellcheck="true">//</span>

<span class="token comment" spellcheck="true">/*调用UPDATE触发器*/</span>
<span class="token keyword">UPDATE</span> customers <span class="token keyword">SET</span> cust_name <span class="token operator">=</span> <span class="token string">'happy'</span> <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@beforeupdate</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@afterupdate</span><span class="token punctuation">;</span>
</code></pre><pre><code>输出为@beforeupdate 为 &#39;happy&#39;，而@afterupdate 为 &#39;reset_name&#39;。有这样一些细节：

1.  NEW 虚拟表中的数据可以更改， 如这里采用
    `SET NEW.cust_name = &#39;reset_name&#39;;`，将待更新的
    `cust_name` 由 `happy` 变成了 `reset_name`；
2.  在 BEFORE UPDATE 触发器中可以使用 NEW 和 OLD 来访问数据，而在 AFTER UPDATE 触发器冲使用 NEW 来访问数据会报错；
</code></pre><p>3.如何删除触发器？</p><p>删除触发器，可以使用 <em>DROP TRIGGER</em> 语句，比如：<br><code>DROP TRIGGER insertcustomers;</code>。触发器不能更新或者覆盖，如果要修改触发器，必须删除这个触发器。</p></div><hr><link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div></div><script src="/libs/share/js/social-share.min.js"></script><div class="reprint"><p><span class="reprint-tip"><i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明: </span><a href="https://yoursite.com" class="b-link-green">Azure sky</a> <i class="fa fa-angle-right fa-lg fa-fw text-color"></i> <a href="/2019/04/05/mysql/" class="b-link-green">MySQL 学习【转载】</a></p></div></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6 overflow-policy" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fa fa-chevron-left"></i>&nbsp;上一篇</div><div class="card"><a href="/2019/04/05/golang-learn/"><div class="card-image"><img src="/medias/featureimages/19.jpg" class="responsive-img" alt="go语言学习"> <span class="card-title">go语言学习</span></div></a><div class="card-content article-content"><div class="summary block-with-text">GO 基础学习变量Go语言定义变量有好几种方式。使用 var关键字是GO最基本定义变量的一种方式，与其他静态类型不一样的是变量类型是写在变量之后的，就像这样：var variable type // var 是声明一个变量，这个是定义一个名</div><div class="publish-info"><span class="publish-date"><i class="fa fa-clock-o fa-fw icon-date"></i>2019-04-05 </span><span class="publish-author"><i class="fa fa-bookmark fa-fw icon-category"></i> <a href="/categories/技术学习/" class="post-category" target="_blank">技术学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/go/" target="_blank"><span class="chip bg-color">go</span></a></div></div></div><div class="article col s12 m6 overflow-policy" data-aos="fade-up"><div class="article-badge right-badge text-color">本篇&nbsp;<i class="fa fa-dot-circle-o"></i></div><div class="card"><a href="/2019/04/05/mysql/"><div class="card-image"><img src="/medias/featureimages/8.jpg" class="responsive-img" alt="MySQL 学习【转载】"> <span class="card-title">MySQL 学习【转载】</span></div></a><div class="card-content article-content"><div class="summary block-with-text">MySQLMySQL 的基本操作可以包括两个方面: MySQL 常用语句如高频率使用的增删改查(CRUD)语句和 MySQL 高级功能, 如存储过程, 触发器, 事务处理器等. 而这两个方面又可以细分如下:Mysql 常用语句表（或者数据库</div><div class="publish-info"><span class="publish-date"><i class="fa fa-clock-o fa-fw icon-date"></i>2019-04-05 </span><span class="publish-author"><i class="fa fa-bookmark fa-fw icon-category"></i> <a href="/categories/技术学习/" class="post-category" target="_blank">技术学习</a></span></div></div><div class="card-action article-tags"><a href="/tags/mysql/" target="_blank"><span class="chip bg-color">mysql</span></a></div></div></div></div></article></div></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fa fa-list"></i></a></div><script src="https://cdn.bootcss.com/tocbot/4.5.1/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><div class="container row center-align"><div class="col s12 m8 l8 copy-right">本站由&copy;<a href="https://blinkfox.github.io/" target="_blank">Blinkfox</a>基于 <a href="https://hexo.io/" target="_blank">Hexo</a> 的 <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">hexo-theme-matery</a>主题搭建. &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp; <span class="white-color">27.6k</span><br><span id="busuanzi_container_site_pv"><i class="fa fa-heart-o"></i> 本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span> </span><span id="busuanzi_container_site_uv"><i class="fa fa-users"></i> 次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.</span></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/WeLeetCoder" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fa fa-github"></i> </a><a href="mailto:zq2640710087@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fa fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2640710087" class="tooltipped" data-tooltip="QQ联系我: 2640710087" data-position="top" data-delay="50"><i class="fa fa-qq"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script type="text/javascript">$(function(){searchFunc("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fa fa-angle-up"></i></a></div><script src="https://cdn.bootcss.com/materialize/1.0.0-rc.1/js/materialize.min.js"></script><script src="https://cdn.bootcss.com/masonry/4.0.0/masonry.pkgd.min.js"></script><script src="https://cdn.bootcss.com/aos/2.3.4/aos.js"></script><script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script><script src="https://cdn.bootcss.com/lightgallery/1.6.11/js/lightgallery.min.js"></script><script src="/js/matery.js"></script><script async src="/libs/others/busuanzi.pure.mini.js"></script></body></html><!-- rebuild by neat -->